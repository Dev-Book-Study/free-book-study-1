# 📘 인텔리제이 학습 자료 요약

## 🔗 참고 사항

- 원본 참고 도서는 **2019년 발행** → 기술 스택 구버전 가능성 있음
- 따라서 **최신 개발 환경(Java 21, Spring Boot 3.4)** 기준 병행 학습 결정

---

## 🧪 테스트 코드 개요

### ✅ TDD vs 단위 테스트 차이점

| 구분        | TDD (Test-Driven Development)         | 단위 테스트 (Unit Test)      |
|-----------|---------------------------------------|-------------------------|
| **목적**    | 설계 중심 개발 방식<br>테스트 먼저 작성 → 코드 작성      | 기능 검증 중심<br>코드 작성 후 테스트 |
| **순서**    | 1. 실패하는 테스트<br>2. 실제 코드 작성<br>3. 리팩토링 | 코드 작성 → 테스트 추가          |
| **주도 방식** | 테스트가 설계를 이끈다                          | 코드가 테스트를 유도한다           |
| **장점**    | 높은 커버리지, 설계 개선                        | 빠른 오류 탐지, 디버깅 용이        |
| **단점**    | 진입 장벽 존재, 시간 소요                       | 테스트 누락, 설계 미흡 가능성       |

---

### 🚀 테스트 코드의 장점

- 🛡 **회귀 방지**: 기존 기능을 깨뜨리지 않도록 자동 검증
- 🔁 **리팩토링 용이성**: 리팩토링 후 기능 유지 여부 검증
- 📘 **문서화**: 테스트 코드 자체가 동작 방식 설명서
- ⏱ **생산성 향상**: 빠른 피드백 루프
- 🔧 **개발 신뢰도 향상**: 안심하고 코드 수정 가능

---

### 🔄 레드-그린-리팩터 사이클

1. 🟥 **Red**: 실패하는 테스트 작성
2. ✅ **Green**: 최소한의 코드로 테스트 통과
3. 🔁 **Refactor**: 코드 개선, 테스트 유지

---

### 🧰 자주 사용하는 테스트 라이브러리

#### 💡 Java / JUnit 기반

| 라이브러리                 | 설명                             |
|-----------------------|--------------------------------|
| **JUnit 5 (Jupiter)** | 표준 단위 테스트 프레임워크                |
| **AssertJ**           | Fluent 스타일 assertion 지원        |
| **Mockito**           | Mock 객체 생성, 행위 검증 도구           |
| **Hamcrest**          | Matcher 기반 검증 (최근엔 AssertJ 선호) |

#### 🛠 Spring Boot 테스트 어노테이션

| 어노테이션 / 도구         | 설명                           |
|--------------------|------------------------------|
| `@SpringBootTest`  | 전체 Spring Context 로딩, 통합 테스트 |
| `@WebMvcTest`      | Controller 계층 테스트            |
| `@DataJpaTest`     | JPA Repository 테스트 전용        |
| `@MockBean`        | Bean을 Mock으로 주입              |
| `TestRestTemplate` | REST API 통합 테스트용             |
| `@Transactional`   | 테스트 후 DB 롤백 처리               |

---

## 🧷 테스트 코드 작성 유형

| 유형               | 설명                                             |
|------------------|------------------------------------------------|
| ✅ **단위 테스트**     | 메서드/클래스 단위 검증, 외부 의존 없음                        |
| 🔗 **통합 테스트**    | 여러 계층 연동 테스트, 실제 컨텍스트 사용                       |
| 🧪 **Mock 테스트**  | 외부 의존성을 가짜(Mock) 객체로 대체                        |
| 🧩 **슬라이스 테스트**  | 계층별 슬라이스 테스트 (`@WebMvcTest`, `@DataJpaTest` 등) |
| 🌐 **E2E 테스트**   | 전체 시스템 흐름을 사용자 시점으로 검증                         |
| 🔁 **회귀 테스트**    | 기존 기능이 리팩토링 후에도 정상 작동하는지 검증                    |
| ⚡ **성능 테스트**     | 처리량, 속도, 부하 등에 대한 테스트 (JMH, JMeter 등 활용)       |
| 🚨 **예외/경계 테스트** | null, 빈 값, 최대/최소 등 엣지 케이스 검증                   |

---

## 🧱 프로젝트 계층별 적합 테스트 전략

| 계층                | 테스트 유형                    | 설명                  |
|-------------------|---------------------------|---------------------|
| `config/util`     | 단위 테스트                    | 유틸 메서드, 설정 로직 검증    |
| `constants/enums` | 단위 테스트                    | Enum 값 매핑, 상수값 검증   |
| `dto`             | Validation 테스트            | 유효성 검사, 필드 예외 처리    |
| `repository`      | `@DataJpaTest`, 통합 테스트    | CRUD, 쿼리 조건 검증      |
| `service`         | 단위 테스트 + Mockito          | 비즈니스 로직, 예외 처리      |
| `controller`      | `@WebMvcTest` + `MockMvc` | API 요청/응답, 상태 코드 검증 |
| `ui`              | `MockMvc`, E2E 테스트        | 뷰 렌더링, 모델 값 검증      |

---

## ✍️ 테스트 코드 실습 예시

### ✔ 단위 테스트

```java

class PersonalInfoMaskerTest {

    @DisplayName("이름 마스킹")
    @ParameterizedTest(name = "{0}을 마스킹하면 {1}이 된다")
    @CsvSource({
            "독독고영재, 독***재",
            "독고영재, 독**재",
            "김희열, 김*열",
            "강혁, 강*",
            "강, 강"
    })
    void maskName(String input, String expected) {
        assertThat(PersonalInfoMasker.maskName(input)).isEqualTo(expected);
    }

    @Test
    @DisplayName("null 또는 빈 문자열 입력 시 그대로 반환")
    void maskNameWithNullOrEmpty() {
        assertThat(PersonalInfoMasker.maskName(null)).isNull();
        assertThat(PersonalInfoMasker.maskName("")).isEmpty();
    }

    @DisplayName("아이디 마스킹")
    @ParameterizedTest(name = "{0}을 마스킹하면 {1}이 된다")
    @CsvSource({
            "test, tes*",
            "abcdef, abc***",
            "user123, use****",
            "john@example.com, joh*@example.com",
            "ab, **",
            "a@b.com, *@b.com"
    })
    void maskId(String input, String expected) {
        assertThat(PersonalInfoMasker.maskId(input)).isEqualTo(expected);
    }

    @DisplayName("이메일 마스킹")
    @ParameterizedTest(name = "{0}을 마스킹하면 {1}이 된다")
    @CsvSource({
            "test@naver.com, tes*@naver.com",
            "abcdef@gmail.com, abc***@gmail.com",
            "ab@naver.com, **@naver.com",
            "user123@example.com, use****@example.com",
            "a@b.com, *@b.com"
    })
    void maskEmail(String input, String expected) {
        assertThat(PersonalInfoMasker.maskEmail(Email.of(input))).isEqualTo(expected);
    }

    @DisplayName("전화번호 마스킹")
    @ParameterizedTest(name = "{0}을 마스킹하면 {1}이 된다")
    @CsvSource({
            "02-1234-5678, 02****5678",
            "02-123-5678, 02***5678",
            "043-123-5678, 043***5678",
            "010-9876-5432, 010****5432",
            "+82 010-9876-5432, +82 010****5432",
            "01012345678, 010****5678",
            "+82 1012345678, +82 10****5678",
            "0212345678, 02****5678",
            "021234567, 02***4567",
            "05412345678, 054****5678",
            "0541234567, 054***4567"
    })
    void maskPhoneNumber(String input, String expected) {
        assertThat(PersonalInfoMasker.maskCell(Cell.of(input))).isEqualTo(expected);
    }
}
```

### Mock 테스트

```java
class ResumeEtcHistoryModifierTest extends ResumeTestBase {
    @InjectMocks
    private ResumeEtcHistoryModifier resumeEtcHistoryModifier;

    @DisplayName("교육이력 데이터가 유효성이 모두 맞을 경우 이슈 없이 모두 저장됨")
    @ParameterizedTest
    @CsvSource(value = {
            "'2022-03-01', '2022-12-01', false, '대외활동', '교내 프로그래밍 동아리 씨부엉 운영진', '씨부엉', '26명의 백엔드 개발자가 참여한 프로젝트의 백엔드 리더로서 객체지향적이며 클린한 코드의 중요성을 배웠습니다.'",
            "'2022-03-01', , false, '자격증', '정보처리기사', '한국산업입력공단', ''",
            " , '2022-12-01', false, '수상이력', '한이음 ICT 멘토링 공모전', '한국정보산업연합회', '한국정보산업연합회장상(입선)'",
    })
    void resume_EtcHistory_Update_Suc_All(LocalDate startTime, LocalDate endTime, Boolean inProgress,
                                          String etcType, String etcName, String etcOrganization, String etcInfo) throws Exception {
        // Arrange
        Resume resume = createResume();

        // Act
        List<ResumeEtcHistoryCommand> commands = List.of(ResumeCommandBuilder.buildEtcHistory(startTime, endTime, inProgress, etcType, etcName, etcOrganization, etcInfo));
        resumeEtcHistoryModifier.modify(resume, commands, DeviceEnvironment.WEB);

        // Assert
        assertThat(resume.getEtcHistories()).hasSameSizeAs(commands);
        resume.getEtcHistories()
                .forEach(etcHistory -> {
                    assertThat(etcHistory.getStartedAt()).isEqualTo(startTime);
                    assertThat(etcHistory.getFinishedAt()).isEqualTo(endTime);
                    assertThat(etcHistory.getInProgress()).isEqualTo(inProgress);
                    assertThat(etcHistory.getEtcType()).isEqualTo(etcType);
                    assertThat(etcHistory.getEtcName()).isEqualTo(etcName);
                    assertThat(etcHistory.getEtcOrganization()).isEqualTo(etcOrganization);
                    assertThat(etcHistory.getEtcInfo()).isEqualTo(etcInfo);
                });
    }

    @DisplayName("기타이력 데이터의 기간이 반대로 되어있으면 기간 전부 저장되지 않음")
    @ParameterizedTest
    @CsvSource(value = {"'2012-01-02', '2011-03-01'"})
    void resume_EtcHistory_Update_Suc_Part_Date(LocalDate startTime, LocalDate endTime) throws Exception {
        // Arrange
        Resume resume = createResume();

        // Act
        List<ResumeEtcHistoryCommand> commands = List.of(ResumeCommandBuilder.buildEtcHistory(startTime, endTime, false, "", "TestEtc", "", ""));
        resumeEtcHistoryModifier.modify(resume, commands, DeviceEnvironment.WEB);

        // Assert
        assertThat(resume.getEtcHistories()).hasSameSizeAs(commands);
        resume.getEtcHistories()
                .forEach(etcHistory -> {
                    assertThat(etcHistory.getStartedAt()).isNull();
                    assertThat(etcHistory.getFinishedAt()).isNull();
                    assertThat(etcHistory.getInProgress()).isFalse();
                    assertThat(etcHistory.getEtcType()).isEmpty();
                    assertThat(etcHistory.getEtcName()).isEqualTo("TestEtc");
                    assertThat(etcHistory.getEtcOrganization()).isEmpty();
                    assertThat(etcHistory.getEtcInfo()).isEmpty();
                });
    }

    @DisplayName("기타이력 데이터가 없거나 모두 유효하지 않으면 저장하지 않음")
    @ParameterizedTest
    @CsvSource(value = {
            " , , false, '', '', '', ''",
            "'2022-03-01', '2021-12-01', false, '', '', '', ''",
    })
    void resume_EtcHistory_Update_Fail(LocalDate startTime, LocalDate endTime, Boolean inProgress,
                                       String etcType, String etcName, String etcOrganization, String etcInfo) throws Exception {
        // Arrange
        Resume resume = createResume();

        // Act
        List<ResumeEtcHistoryCommand> commands = List.of(ResumeCommandBuilder.buildEtcHistory(startTime, endTime, inProgress, etcType, etcName, etcOrganization, etcInfo));
        resumeEtcHistoryModifier.modify(resume, commands, DeviceEnvironment.WEB);

        // Assert
        assertThat(resume.getEtcHistories()).isEmpty();
    }
}

```